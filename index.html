<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DApp de Vote – MetaMask</title>
    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --accent: #ff6b6b;
            --bg: #f6f8ff;
            --text: #1d2433;
            --muted: #6b7280;
            --ok: #16a34a;
            --warn: #f59e0b;
            --err: #dc2626;
            --card: #ffffff;
            --ring: rgba(78, 84, 200, 0.15);
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: var(--text);
        }

        .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; }

        header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white; border-radius: 16px; padding: 28px 24px; box-shadow: 0 12px 30px rgba(0,0,0,.18);
        }
        header h1 { margin: 0 0 6px; font-size: 28px; }
        header p { margin: 0; opacity: .9; }

        .grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; margin-top: 20px; }

        .card { background: var(--card); border-radius: 14px; box-shadow: 0 10px 28px rgba(0,0,0,.12); padding: 18px; border: 1px solid #eef0ff; }
        .card h2, .card h3 { margin-top: 0; color: var(--primary); }
        .subtle { color: var(--muted); font-size: 14px; }

        .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .stack { display: grid; gap: 10px; }

        .btn { appearance: none; border: 0; cursor: pointer; background: linear-gradient(90deg, var(--primary), var(--secondary)); color: white; padding: 10px 16px; border-radius: 999px; font-weight: 600; box-shadow: 0 4px 12px rgba(78,84,200,.25); transition: transform .15s ease, box-shadow .15s ease; font-size: 14px; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(78,84,200,.3); }
        .btn-ghost { background: #eef0ff; color: var(--primary); box-shadow: none; }
        .btn-danger { background: var(--err); box-shadow: 0 4px 12px rgba(220,38,38,.25); }
        .btn-ok { background: var(--ok); box-shadow: 0 4px 12px rgba(22,163,74,.25); }

        .badge { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: #eef0ff; color: var(--primary); }
        .badge-ok { background: #e7f7ec; color: var(--ok); }
        .badge-warn { background: #fff7e6; color: var(--warn); }
        .badge-err { background: #fdecec; color: var(--err); }

        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

        input, textarea, select { width: 100%; padding: 11px 12px; border-radius: 10px; border: 1px solid #e5e7eb; outline: none; background: white; font-size: 14px; color: var(--text); transition: box-shadow .15s ease, border-color .15s ease; }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 0 6px var(--ring); }
        label { font-size: 13px; color: var(--muted); }

        .list { display: grid; gap: 10px; }
        .item { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 12px; border: 1px solid #eef0ff; border-radius: 12px; background: white; }

        .hr { height: 1px; background: #eef0ff; margin: 10px 0; border-radius: 1px; }

        .tabs { display: flex; gap: 6px; }
        .tab { padding: 8px 12px; border-radius: 999px; background: #eef0ff; color: var(--primary); cursor: pointer; font-weight: 600; font-size: 13px; }
        .tab.active { background: linear-gradient(90deg, var(--primary), var(--secondary)); color: white; }

        .snackbar { position: fixed; left: 50%; transform: translateX(-50%); bottom: 24px; background: #111827; color: white; padding: 12px 16px; border-radius: 10px; display: none; box-shadow: 0 10px 24px rgba(0,0,0,.35); }

        footer { text-align: center; color: white; margin: 20px 0 10px; opacity: .9; }

        @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="wrap">
    <header>
        <h1>DApp de Vote</h1>
        <p>Connexion MetaMask, création de candidats et historique des votes en direct.</p>
    </header>

    <!-- Connexion & Réseau -->
    <section class="grid" style="margin-top: 16px;">
        <div class="card">
            <h2>Portefeuille</h2>
            <div id="walletArea" class="stack">
                <div class="row">
                    <span id="connBadge" class="badge badge-err">Non connecté</span>
                    <span id="netBadge" class="badge">Réseau: inconnu</span>
                    <span id="contractBadge" class="badge">Contrat: —</span>
                </div>
                <div class="row" id="accountRow" style="display:none;">
                    <div>
                        <div class="subtle">Compte connecté</div>
                        <div class="mono" id="accountAddr">—</div>
                    </div>
                    <button id="btnCopy" class="btn btn-ghost">Copier</button>
                    <button id="btnDisconnect" class="btn btn-ghost">Déconnecter (UI)</button>
                </div>
                <div class="row" id="connectRow">
                    <button id="btnConnect" class="btn">Se connecter avec MetaMask</button>
                    <button id="btnRetry" class="btn btn-ghost" style="display:none;">Réessayer</button>
                </div>
                <div class="subtle" id="ownerInfo" style="display:none;">Vous êtes le <strong>propriétaire</strong> du contrat (administration activée).</div>
            </div>
        </div>

        <!-- Admin only -->
        <div class="card" id="adminCard" style="display:none;">
            <h2>Administration</h2>
            <div class="stack">
                <div class="stack">
                    <label for="candName">Créer un vote (ajouter un candidat)</label>
                    <div class="row">
                        <input id="candName" type="text" placeholder="Nom du candidat / proposition" />
                        <button id="btnAddCand" class="btn">Créer</button>
                    </div>
                </div>
                <div class="hr"></div>
                <div class="stack">
                    <label for="voterAddr">Autoriser un votant (adresse)</label>
                    <div class="row">
                        <input id="voterAddr" type="text" placeholder="0x…" />
                        <button id="btnAllowVoter" class="btn btn-ok">Autoriser</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Corps principal -->
    <section class="grid">
        <div class="card">
            <h2>Candidats & Voter</h2>
            <div id="candList" class="list">
                <div class="subtle">Chargement des candidats…</div>
            </div>
            <div class="hr"></div>
            <div class="stack" id="manualVoteBox">
                <label for="manualVoteInput">Vote manuel (ID ou nom du candidat)</label>
                <div class="row">
                    <input id="manualVoteInput" type="text" placeholder="Ex: 0 ou &quot;Alice&quot;" />
                    <button id="btnManualVote" class="btn">Voter</button>
                </div>
                <div class="subtle">Utile si la liste n'apparaît pas ou pour saisir un ID directement.</div>
            </div>
            <div class="row" style="margin-top:10px;">
                <button id="btnRefreshCand" class="btn btn-ghost">Rafraîchir</button>
            </div>
        </div>

        <div class="card">
            <h2>Statut de vote</h2>
            <div id="voterStatus" class="stack">
                <div class="subtle">Connectez votre portefeuille pour voir votre statut.</div>
            </div>

            <div class="hr"></div>

            <h3>Historique</h3>
            <div class="tabs" style="margin-bottom:10px;">
                <div class="tab active" id="tabMine">Mon historique</div>
                <div class="tab" id="tabAll">Tous les votes</div>
            </div>
            <div id="history" class="list">
                <div class="subtle">Aucun historique.</div>
            </div>
            <div class="row" style="margin-top:10px;">
                <button id="btnRefreshHistory" class="btn btn-ghost">Rafraîchir</button>
            </div>
        </div>
    </section>

    <footer>
        DApp de Vote © 2025 — Propulsé par Ethereum & MetaMask
    </footer>
</div>

<div id="snackbar" class="snackbar"></div>

<!-- Web3.js -->
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script>
    /*********************************
     * CONFIG – À ADAPTER
     *********************************/
    const CONTRACT_ADDRESS = "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512"; // ⚠️ remplace par l'adresse de TON contrat

    const CONTRACT_ABI = [
        {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
        {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"candidateId","type":"uint256"},{"indexed":false,"internalType":"string","name":"name","type":"string"}],"name":"CandidateAdded","type":"event"},
        {"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"voter","type":"address"}],"name":"VoterAdded","type":"event"},
        {"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"voter","type":"address"},{"indexed":false,"internalType":"uint256","name":"candidateId","type":"uint256"}],"name":"VoteCast","type":"event"},
        {"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"addCandidate","outputs":[],"stateMutability":"nonpayable","type":"function"},
        {"inputs":[{"internalType":"address","name":"_voter","type":"address"}],"name":"addVoter","outputs":[],"stateMutability":"nonpayable","type":"function"},
        {"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"candidates","outputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"voteCount","type":"uint256"}],"stateMutability":"view","type":"function"},
        {"inputs":[{"internalType":"uint256","name":"_candidateId","type":"uint256"}],"name":"getCandidate","outputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"voteCount","type":"uint256"}],"stateMutability":"view","type":"function"},
        {"inputs":[{"internalType":"address","name":"_voter","type":"address"}],"name":"getVoter","outputs":[{"internalType":"bool","name":"isAllowed","type":"bool"},{"internalType":"bool","name":"hasVoted","type":"bool"},{"internalType":"uint256","name":"votedCandidateId","type":"uint256"}],"stateMutability":"view","type":"function"},
        {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
        {"inputs":[{"internalType":"uint256","name":"_candidateId","type":"uint256"}],"name":"vote","outputs":[],"stateMutability":"nonpayable","type":"function"},
        {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"voters","outputs":[{"internalType":"bool","name":"isAllowed","type":"bool"},{"internalType":"bool","name":"hasVoted","type":"bool"},{"internalType":"uint256","name":"votedCandidateId","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];

    const DEPLOYMENT_BLOCK = 0; // (optionnel) mets le block du déploiement

    /*********************************
     * ÉTAT GLOBAL
     *********************************/
    let web3;            // Web3 instance
    let contract;        // Contrat Web3
    let account = null;  // Adresse connectée
    let isOwner = false; // Flag admin
    let tab = 'mine';    // onglet historique actif
    let candCache = [];  // candidats pour vote manuel

    /*********************************
     * UTILITAIRES UI
     *********************************/
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const short = (addr) => addr ? addr.slice(0,6) + '…' + addr.slice(-4) : '';
    const show = (el, v=true) => el.style.display = v ? '' : 'none';
    const snackbar = (msg) => { const el = $('#snackbar'); el.textContent = msg; el.style.display = 'block'; setTimeout(() => el.style.display = 'none', 2800); };

    const setBadges = async () => {
        const connBadge = $('#connBadge');
        const netBadge = $('#netBadge');
        const contractBadge = $('#contractBadge');

        if (!account) {
            connBadge.textContent = 'Non connecté';
            connBadge.className = 'badge badge-err';
            netBadge.textContent = 'Réseau: inconnu';
            contractBadge.textContent = 'Contrat: —';
            return;
        }

        connBadge.textContent = 'Connecté';
        connBadge.className = 'badge badge-ok';

        try {
            const chainIdHex = await window.ethereum.request({ method: 'eth_chainId' });
            const chainId = parseInt(chainIdHex, 16);
            const names = {1:'Ethereum',5:'Goerli',11155111:'Sepolia',137:'Polygon',80001:'Mumbai',31337:'Hardhat',1337:'Localhost',5777:'Ganache'};
            netBadge.textContent = `Réseau: ${names[chainId] || chainId}`;
        } catch(e) { netBadge.textContent = 'Réseau: inconnu'; }

        try {
            const code = await web3.eth.getCode(CONTRACT_ADDRESS);
            if (code && code !== '0x') { contractBadge.textContent = 'Contrat: OK'; contractBadge.className = 'badge badge-ok'; }
            else { contractBadge.textContent = 'Contrat: introuvable'; contractBadge.className = 'badge badge-err'; }
        } catch(e) { contractBadge.textContent = 'Contrat: erreur'; contractBadge.className = 'badge badge-warn'; }
    };

    /*********************************
     * INITIALISATION & WALLET
     *********************************/
    const init = async () => {
        if (!window.ethereum) { snackbar('MetaMask non détecté. Installe-le pour continuer.'); return; }

        web3 = new Web3(window.ethereum);
        contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);

        try { const accs = await window.ethereum.request({ method: 'eth_requestAccounts' }); if (accs && accs.length) { account = accs[0]; } } catch (e) {}

        await postConnectUI();

        window.ethereum.on('accountsChanged', async (accs) => { account = accs && accs.length ? accs[0] : null; await postConnectUI(); });
        window.ethereum.on('chainChanged', () => window.location.reload());

        $('#btnConnect').addEventListener('click', connectWallet);
        $('#btnRetry').addEventListener('click', connectWallet);
        $('#btnCopy').addEventListener('click', async () => { try { await navigator.clipboard.writeText(account); snackbar('Adresse copiée.'); } catch(e) {} });
        $('#btnDisconnect').addEventListener('click', () => { account = null; isOwner = false; updateWalletUI(); $('#voterStatus').innerHTML = '<div class="subtle">Connectez votre portefeuille pour voir votre statut.</div>'; $('#candList').innerHTML = '<div class="subtle">Connectez-vous pour charger les candidats.</div>'; $('#history').innerHTML = '<div class="subtle">Aucun historique.</div>'; setBadges(); });

        $('#btnAddCand').addEventListener('click', onAddCandidate);
        $('#btnAllowVoter').addEventListener('click', onAllowVoter);
        $('#btnRefreshCand').addEventListener('click', loadCandidates);
        $('#btnRefreshHistory').addEventListener('click', loadHistory);
        $('#btnManualVote').addEventListener('click', onManualVote);
        $('#manualVoteInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ onManualVote(); }});

        $('#tabMine').addEventListener('click', () => { tab='mine'; setTabUI(); loadHistory(); });
        $('#tabAll').addEventListener('click', () => { tab='all'; setTabUI(); loadHistory(); });
    };

    const connectWallet = async () => {
        if (!window.ethereum) return snackbar('MetaMask non détecté.');
        try { const accs = await window.ethereum.request({ method: 'eth_requestAccounts' }); account = accs[0]; await postConnectUI(); snackbar('Portefeuille connecté.'); } catch (e) { snackbar('Connexion refusée.'); }
    };

    const postConnectUI = async () => {
        updateWalletUI();
        await setBadges();
        if (account) {
            await checkOwner();
            await Promise.all([ loadCandidates(), loadVoterStatus(), loadHistory() ]);
            subscribeLight();
        }
    };

    const updateWalletUI = () => {
        if (account) { $('#accountAddr').textContent = account; show($('#accountRow'), true); show($('#connectRow'), false); show($('#btnRetry'), false); $('#connBadge').className = 'badge badge-ok'; }
        else { show($('#accountRow'), false); show($('#connectRow'), true); show($('#btnRetry'), true); $('#connBadge').className = 'badge badge-err'; }
    };

    const checkOwner = async () => {
        try { const owner = await contract.methods.owner().call(); isOwner = owner && account && owner.toLowerCase() === account.toLowerCase(); show($('#adminCard'), isOwner); show($('#ownerInfo'), isOwner); }
        catch (e) { isOwner = false; show($('#adminCard'), false); show($('#ownerInfo'), false); }
    };

    /*********************************
     * CHARGEMENT CANDIDATS & VOTE
     *********************************/
    const MAX_CANDIDATES = 100;

    const loadCandidates = async () => {
        const box = $('#candList');
        box.innerHTML = '<div class="subtle">Chargement…</div>';
        if (!contract) return;

        const items = [];
        for (let i=0;i<MAX_CANDIDATES;i++) {
            try {
                const c = await contract.methods.getCandidate(i).call();
                if (!c.name && c.voteCount === '0') break;
                items.push({ id: i, name: c.name, votes: c.voteCount });
            } catch (e) { break; }
        }
        candCache = items;

        if (!items.length) { box.innerHTML = '<div class="subtle">Aucun candidat pour le moment.</div>'; return; }

        box.innerHTML = '';
        for (const it of items) {
            const el = document.createElement('div');
            el.className = 'item';
            el.innerHTML = `
          <div>
            <div style="font-weight:700">${escapeHtml(it.name)}</div>
            <div class="subtle">ID: ${it.id} • <span class="badge">${it.votes} vote(s)</span></div>
          </div>
          <button class="btn" data-id="${it.id}">Voter</button>
        `;
            el.querySelector('button').addEventListener('click', () => voteFor(it.id));
            box.appendChild(el);
        }
    };

    const voteFor = async (id) => {
        if (!account) return snackbar('Connecte ton portefeuille.');
        try { const v = await contract.methods.getVoter(account).call(); if (!v.isAllowed) return snackbar("Tu n'es pas autorisé à voter."); if (v.hasVoted) return snackbar('Tu as déjà voté.'); }
        catch(e) { return snackbar("Statut de votant inconnu. Es-tu bien autorisé ?"); }
        if (!confirm(`Confirmer le vote pour le candidat #${id} ?`)) return;
        try { await contract.methods.vote(id).send({ from: account }); snackbar('Vote enregistré ✅'); await Promise.all([loadCandidates(), loadVoterStatus(), loadHistory()]); }
        catch (e) { snackbar('Échec du vote: ' + (e?.message?.split('\n')[0] || 'Erreur')); }
    };

    const loadVoterStatus = async () => {
        const box = $('#voterStatus');
        if (!account) return box.innerHTML = '<div class="subtle">Connectez votre portefeuille pour voir votre statut.</div>';
        try {
            const v = await contract.methods.getVoter(account).call();
            let html = '';
            html += v.isAllowed ? '<span class="badge badge-ok">Autorisé à voter</span>' : '<span class="badge badge-err">Non autorisé</span>';
            html += ' ';
            html += v.hasVoted ? '<span class="badge">A déjà voté</span>' : '<span class="badge">Pas encore voté</span>';
            if (v.hasVoted) {
                try { const c = await contract.methods.getCandidate(v.votedCandidateId).call(); html += `<div class="subtle">Ton vote: <strong>${escapeHtml(c.name)}</strong> (ID ${v.votedCandidateId})</div>`; }
                catch(e) { html += `<div class="subtle">Ton vote: candidat #${v.votedCandidateId}</div>`; }
            }
            box.innerHTML = html;
        } catch(e) { box.innerHTML = '<span class="badge badge-warn">Impossible de récupérer ton statut (non inscrit ?)</span>'; }
    };

    /*********************************
     * ADMIN : ajouter candidat / voter
     *********************************/
    const onAddCandidate = async () => {
        if (!isOwner) return snackbar("Réservé à l'admin.");
        const name = $('#candName').value.trim();
        if (!name) return snackbar('Nom requis.');
        try { await contract.methods.addCandidate(name).send({ from: account }); $('#candName').value = ''; snackbar('Candidat créé.'); await loadCandidates(); }
        catch(e) { snackbar('Échec création: ' + (e?.message?.split('\n')[0] || 'Erreur')); }
    };

    const onAllowVoter = async () => {
        if (!isOwner) return snackbar("Réservé à l'admin.");
        const addr = $('#voterAddr').value.trim();
        if (!/^0x[a-fA-F0-9]{40}$/.test(addr)) return snackbar('Adresse invalide.');
        try { await contract.methods.addVoter(addr).send({ from: account }); $('#voterAddr').value=''; snackbar('Votant autorisé.'); await loadVoterStatus(); }
        catch(e) { snackbar("Échec d'autorisation: " + (e?.message?.split('\n')[0] || 'Erreur')); }
    };

    /*********************************
     * VOTE MANUEL (ID ou nom)
     *********************************/
    const onManualVote = async () => {
        if (!account) return snackbar('Connecte ton portefeuille.');
        const val = ($('#manualVoteInput')?.value || '').trim();
        if (!val) return snackbar('Saisis un ID ou un nom.');
        let id = null;
        if (/^\d+$/.test(val)) { id = parseInt(val, 10); }
        else { const found = candCache.find(c => (c.name || '').toLowerCase() === val.toLowerCase()); if (found) id = found.id; }
        if (id === null || Number.isNaN(id)) return snackbar('Candidat introuvable.');
        await voteFor(id);
    };

    /*********************************
     * HISTORIQUE (événements)
     *********************************/
    const setTabUI = () => { $('#tabMine').classList.toggle('active', tab==='mine'); $('#tabAll').classList.toggle('active', tab==='all'); };

    const loadHistory = async () => {
        const box = $('#history');
        box.innerHTML = '<div class="subtle">Chargement…</div>';
        if (!contract) return;
        try {
            const events = await contract.getPastEvents('VoteCast', { fromBlock: DEPLOYMENT_BLOCK, toBlock: 'latest' });
            const byBlock = {};
            const blocks = [...new Set(events.map(e => e.blockNumber))];
            const blockInfos = await Promise.all(blocks.map(bn => web3.eth.getBlock(bn)));
            blockInfos.forEach(b => byBlock[b.number] = b.timestamp);

            const rows = [];
            for (const ev of events) {
                const voter = ev.returnValues.voter;
                const candId = parseInt(ev.returnValues.candidateId);
                let candName = `#${candId}`;
                try { const c = await contract.methods.getCandidate(candId).call(); if (c && c.name) candName = c.name; } catch {}
                const when = new Date((byBlock[ev.blockNumber] || Date.now()/1000) * 1000);
                rows.push({ voter, candId, candName, when, block: ev.blockNumber, tx: ev.transactionHash });
            }

            const filtered = tab==='mine' && account ? rows.filter(r => r.voter.toLowerCase() === account.toLowerCase()) : rows;
            filtered.sort((a,b) => b.when - a.when);

            if (!filtered.length) { box.innerHTML = '<div class="subtle">Aucun événement.</div>'; return; }

            box.innerHTML = '';
            for (const r of filtered.slice(0, 200)) {
                const el = document.createElement('div');
                el.className = 'item';
                el.innerHTML = `
            <div>
              <div><strong>${escapeHtml(r.candName)}</strong></div>
              <div class="subtle">Votant: <span class="mono">${short(r.voter)}</span> • Bloc ${r.block} • ${r.when.toLocaleString()}</div>
            </div>
            <a class="btn btn-ghost" href="https://etherscan.io/tx/${r.tx}" target="_blank" rel="noreferrer">Tx</a>
          `;
                box.appendChild(el);
            }
        } catch (e) { box.innerHTML = '<div class="subtle">Impossible de charger les événements (réseau ou droits restreints).</div>'; }
    };

    let lightInterval = null;
    const subscribeLight = () => { if (lightInterval) clearInterval(lightInterval); lightInterval = setInterval(() => { loadCandidates(); loadHistory(); loadVoterStatus(); }, 15000); };

    /*********************************
     * HELPERS
     *********************************/
    function escapeHtml(str) { return String(str).replace(/[&<>\"]/g, (s) => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[s] || s)); }

    window.addEventListener('load', init);
</script>
</body>
</html>
